<mat-expansion-panel class="section-panel" [expanded]="true">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <mat-icon>{{ processedImageUrl ? 'check_circle' : 'auto_fix_high' }}</mat-icon>
      {{ processedImageUrl ? 'Enhancement Results' : 'AI Image Enhancement' }}
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="panel-content">
    <!-- Image Preview (shown when no result) -->
    <div class="image-preview" *ngIf="!processedImageUrl">
      <img *ngIf="imagePreview" [src]="imagePreview" alt="Original image" class="preview-image">
      <p *ngIf="!imagePreview" class="no-image-text">
        <mat-icon>image</mat-icon>
        Upload an image to preview
      </p>
    </div>

    <!-- Results View (replaces preview) -->
    <div class="results-view" *ngIf="processedImageUrl">
      <div class="comparison-container">
        <div class="image-side">
          <label>Original</label>
          <img [src]="imagePreview" alt="Original" />
        </div>

        <mat-icon class="arrow-icon">arrow_forward</mat-icon>

        <div class="image-side">
          <label>Enhanced</label>
          <img [src]="processedImageUrl" alt="Enhanced" />
        </div>
      </div>
    </div>

    <!-- Progress Bar (shown during processing) -->
    <div class="panel-footer" *ngIf="isProcessing">
      <div class="progress-section">
        <mat-progress-bar 
          mode="determinate" 
          [value]="progress.progress"
          [color]="progress.status === 'error' ? 'warn' : 'primary'">
        </mat-progress-bar>
        <p class="progress-text">
          <mat-icon class="progress-icon">{{ getProgressIcon() }}</mat-icon>
          {{ progress.message }}
        </p>
        <p class="progress-percentage">{{ progress.progress | number:'1.0-0' }}%</p>
      </div>
    </div>

    <!-- Download Button (shown when result exists) -->
    <div class="panel-footer" *ngIf="processedImageUrl && !isProcessing">
      <button 
        mat-raised-button 
        color="accent"
        (click)="downloadImage()"
        class="download-button">
        <mat-icon>download</mat-icon>
        Download Enhanced Image
      </button>
    </div>
  </div><!-- /panel-content -->
</mat-expansion-panel>
